<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>{% block title %}{% endblock %} | NaiveFileManager</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/ant-design-vue@1.7.8/dist/antd.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/theme/monokai.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ant-design-vue@1.7.8/dist/antd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/javascript/javascript.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/xml/xml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/css/css.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/python/python.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/shell/shell.js"></script>
  </head>
  <body>
    <div id="app">
      <a-layout style="min-height: 100vh">
        <a-layout-sider theme="dark">
          <div
            class="logo"
            style="
              height: 64px;
              padding: 16px;
              color: white;
              text-align: center;
            "
          >
            <h2 style="margin: 0; color: white">NaiveFileManager</h2>
          </div>
          <a-menu
            theme="dark"
            mode="inline"
            :default-selected-keys="['{% block menu_key %}{% endblock %}']"
            style="height: calc(100% - 64px)"
            @click="handleMenuClick"
          >
            <a-menu-item key="files">
              <a-icon type="folder"></a-icon>
              <span>文件管理</span>
            </a-menu-item>
            {% if user.role == 'admin' %}
            <a-menu-item key="logs">
              <a-icon type="file-text"></a-icon>
              <span>日志审计</span>
            </a-menu-item>
            <a-menu-item key="users">
              <a-icon type="team"></a-icon>
              <span>用户管理</span>
            </a-menu-item>
            {% endif %}
          </a-menu>
        </a-layout-sider>
        <a-layout>
          <a-layout-header
            style="
              background: #001529;
              padding: 0 16px;
              display: flex;
              justify-content: space-between;
              align-items: center;
            "
          >
            <div style="font-size: 16px; font-weight: 500; color: white">
              {{ self.title() }}
            </div>
            <div style="display: flex; align-items: center">
              <a-dropdown>
                <a class="ant-dropdown-link" style="color: white">
                  <a-icon type="user"></a-icon>
                  {{ user.username }}
                  <a-icon type="down"></a-icon>
                </a>
                <a-menu slot="overlay">
                  <a-menu-item key="change_password" @click="showChangePasswordModal">
                    <a-icon type="lock"></a-icon>
                    修改密码
                  </a-menu-item>
                  <a-menu-divider></a-menu-divider>
                  <a-menu-item key="logout" @click="handleLogout">
                    <a-icon type="logout"></a-icon>
                    退出登录
                  </a-menu-item>
                </a-menu>
              </a-dropdown>
            </div>
          </a-layout-header>
          {% block content %}{% endblock %}
        </a-layout>
      </a-layout>
      {% block modal %}{% endblock %}
      <a-modal
        :visible="changePasswordVisible"
        title="修改密码"
        @ok="handleChangePassword"
        @cancel="changePasswordVisible = false"
        :ok-text="'确定'"
        :cancel-text="'取消'"
      >
        <a-form-item label="当前密码">
          <a-input-password v-model="changePasswordForm.old_password" placeholder="请输入当前密码"></a-input-password>
        </a-form-item>
        <a-form-item label="新密码">
          <a-input-password v-model="changePasswordForm.new_password" placeholder="请输入新密码"></a-input-password>
          <div style="color: #999; font-size: 12px; margin-top: 4px;">
            密码要求：长度至少12位，必须包含大小写字母、数字和特殊字符
          </div>
        </a-form-item>
        <a-form-item label="确认新密码">
          <a-input-password v-model="changePasswordForm.confirm_password" placeholder="请再次输入新密码"></a-input-password>
        </a-form-item>
      </a-modal>
    </div>
    {% block script %}{% endblock %}
  </body>
</html>
