NaiveFileManager 在线文件管理系统设计说明书
===

## 1. 引言

### 1.1 目的

本设计说明书旨在明确 NaiveFileManager 在线文件管理系统的概要设计、详细设计和部署计划，确保开发者能够准确理解系统架构、模块设计和部署流程，同时作为后续系统开发、测试和部署的依据。

### 1.2 范围

本系统旨在提供一个在线平台，使运维人员和管理人员能够在浏览器中便捷地管理 Linux 服务器上的文件，管理人员能够进行用户管理和日志审计。系统基于 FastAPI 框架，遵循 OpenAPI 3.1 规范。

### 1.3 定义、缩写和术语

- **FastAPI**: 一个现代、快速、高性能的 Web 框架，用于构建 API 服务。
- **OpenAPI**: 一种规范，用于定义和描述 RESTful APIs。
- **运维人员（普通用户）**: 负责系统维护、监控、故障排查等工作的专业人员。
- **管理人员（管理员）**: 负责用户管理、权限分配等管理工作的专业人员。
- **行为审计**: 记录并跟踪用户操作的系统功能，用于安全审计和合规性检查。

## 2. 总体设计

### 2.1 硬件运行环境

1. 服务器：内存 1GB 以上，已接入网络（内网或公网）
2. 客户端：满足运行现代浏览器的硬件要求，支持通过网络访问服务器

### 2.2 软件运行环境

1. 服务器：Linux 操作系统，Python 3.12（直接运行）或 Docker 运行环境（Docker 运行）
2. 客户端：操作系统无要求，现代浏览器（Chrome、Firefox、Safari 等）

### 2.3 子系统清单

| 子系统编号 | 子系统名称   | 子系统功能描述                             |
| ---------- | ------------ | ------------------------------------------ |
| 1          | 用户管理系统 | 实现用户登录、密码修改，用户增、删、查、改 |
| 2          | 文件管理系统 | 实现 Linux 文件系统相关的文件操作          |
| 3          | 日志审计系统 | 实现用户操作日志的记录和查询               |

### 2.4 功能模块清单

| 模块编号 | 模块名称           | 所属子系统   | 功能描述                                                                   |
| -------- | ------------------ | ------------ | -------------------------------------------------------------------------- |
| 101      | 用户登录           | 用户管理系统 | 用户通过用户名和密码登录系统，验证用户身份并返回登录状态                   |
| 102      | 用户注销           | 用户管理系统 | 用户主动注销当前会话，清除登录状态                                         |
| 103      | 用户列表           | 用户管理系统 | 管理员获取系统中所有用户的信息，包括用户名、基础目录、权限等               |
| 104      | 创建用户           | 用户管理系统 | 管理员创建新用户，分配用户名、密码、基础目录和角色，并返回创建结果         |
| 105      | 更新用户           | 用户管理系统 | 管理员更新用户信息，如密码、基础目录和角色，并返回更新结果                 |
| 106      | 删除用户           | 用户管理系统 | 管理员删除指定用户，并返回删除结果                                         |
| 107      | 修改密码           | 用户管理系统 | 用户修改自己的密码，需要输入旧密码和新密码，并返回修改结果                 |
| 201      | 文件列表           | 文件管理系统 | 用户获取指定目录下的文件列表，包括文件名、路径、权限等信息                 |
| 202      | 文件下载           | 文件管理系统 | 用户下载指定文件，返回文件内容的二进制数据                                 |
| 203      | 文件读取           | 文件管理系统 | 用户在线读取文件内容，返回文件内容的文本数据                               |
| 204      | 文件写入           | 文件管理系统 | 用户在线编辑并保存文件内容，需要输入文件路径和新内容，返回保存结果         |
| 205      | 文件权限修改       | 文件管理系统 | 用户设置或修改文件的权限，需要输入文件路径和权限设置，返回设置结果         |
| 206      | 文件移动           | 文件管理系统 | 用户移动文件到指定目录，需要输入源文件路径和目标目录，返回移动结果         |
| 207      | 删除文件           | 文件管理系统 | 用户删除指定文件，需要输入文件路径，返回删除结果                           |
| 208      | 创建文件           | 文件管理系统 | 用户在指定目录下创建新文件，需要输入目录路径和文件名，返回创建结果         |
| 209      | 上传文件           | 文件管理系统 | 用户上传文件到指定目录，需要输入目录路径和文件内容（二进制），返回上传结果 |
| 210      | 操作系统用户组列表 | 文件管理系统 | 用户获取 Linux 操作系统用户组列表，返回用户组名称和相关信息                  |
| 211      | 操作系统用户列表   | 文件管理系统 | 用户获取 Linux 操作系统用户列表，返回用户名和相关信息                        |
| 301      | 日志审计           | 日志审计系统 | 管理员获取系统日志，用于行为审计，可以输入时间范围来筛选日志记录           |

### 2.5 数据存储格式

#### 2.5.1 用户信息

| 序号 | 字段原始名称 | 字段中文名称   | 备注                                                         |
| ---- | ------------ | -------------- | ------------------------------------------------------------ |
| 1    | id           | 用户唯一标识符 | 用于在文件系统中快速定位存储用户信息的文件                   |
| 2    | username     | 用户名         |   应取唯一值                                                           |
| 3    | password     | 密码哈希       | 使用 Argon2 算法对明文密码加盐哈希后存储                     |
| 4    | base_dir     | 基础目录       | 用于限制用户的访问范围，用户只能访问基础目录下的子目录和文件 |
| 5    | role         | 角色           | 可取值 `admin` 或 `user`，用于基于角色的授权                  |

#### 2.5.2 操作日志

| 序号 | 字段原始名称 | 字段中文名称 | 备注                                       |
| ---- | ------------ | ------------ | ------------------------------------------ |
| 1    | timestamp    | 时间         | 记录日志产生的时间                         |
| 2    | action       | 操作         | 对应功能模块清单中的模块名称               |
| 3    | username     | 用户名       | 操作的发起用户                             |
| 4    | message      | 详细信息     | 操作的详细内容                             |
| 5    | success      | 状态         | 可取值 `True` 或 `False`，标识操作是否成功 |

### 2.6 技术选型

系统后端选用 FastAPI 框架。FastAPI 是一个高性能且轻量级的 Python Web 框架，可结合 Pydantic 库定义接口的数据模型，不仅能够增强数据处理的准确性和效率，还能够提了代码的可读性和可维护性。此外，FastAPI 框架能够自动生成符合 OpenAPI 规范的 API 文档，极大简化 API 的测试、调试及集成流程，有助于提高开发效率。

系统前端采用 Vue 2 框架，结合 Ant Design 前端组件库。Vue 2 作为一个渐进式的 JavaScript 框架，适合构建功能丰富且界面友好的单页面应用。Ant Design 是一套设计优雅、功能全面的组件库，提供大量外观统一、交互流畅、具备高度可配置性和可扩展性的组件，能够加速前端开发进程，确保用户界面的美观性和用户体验的一致性。

## 3. 典型功能模块的详细设计

由于系统包含众多功能模块，且其中许多在设计上存在相似之处，以下仅选取部分典型功能模块展示详细设计。

### 3.1 用户登录

![](https://notes.sjtu.edu.cn/uploads/upload_72d35040f0d7313c29283c70edf8bec3.png)


### 3.2 创建用户

![](https://notes.sjtu.edu.cn/uploads/upload_7a95abb5190b545a68527a6017f9d979.png)

### 3.3 文件列表

![](https://notes.sjtu.edu.cn/uploads/upload_c679eaa7ed9b241d29af66ca513e626c.png)

### 3.4 文件读取

![](https://notes.sjtu.edu.cn/uploads/upload_79e1467a9b8e3aeaba71c3e66d9b07a1.png)

### 3.5 文件删除

![](https://notes.sjtu.edu.cn/uploads/upload_bb0b8be338e400c137583c3e4d86cc6f.png)

### 3.6 日志审计

![](https://notes.sjtu.edu.cn/uploads/upload_0d3dda08e0e3ffafebf9a73aae6cb4ae.png)

## 4. 角色授权设计

| 功能模块名称       | 管理人员（管理员） | 运维人员（普通用户） | 访客 |
| ------------------ |:------------------:|:--------------------:|:----:|
| 用户登录           |         ●          |          ●           |  ●   |
| 用户注销           |         ●          |          ●           |      |
| 用户列表           |         ●          |                      |      |
| 创建用户           |         ●          |                      |      |
| 更新用户           |         ●          |                      |      |
| 删除用户           |         ●          |                      |      |
| 修改密码           |         ●          |          ●           |      |
| 文件列表           |         ●          |          ○           |      |
| 文件下载           |         ●          |          ○           |      |
| 文件读取           |         ●          |          ○           |      |
| 文件写入           |         ●          |          ○           |      |
| 文件权限修改       |         ●          |          ○           |      |
| 文件移动           |         ●          |          ○           |      |
| 删除文件           |         ●          |          ○           |      |
| 创建文件           |         ●          |          ○           |      |
| 上传文件           |         ●          |          ○           |      |
| 操作系统用户组列表 |         ●          |          ●           |      |
| 操作系统用户列表   |         ●          |          ●           |      |
| 日志审计           |         ●          |                      |      |

● 表示拥有全部权限，○ 表示拥有部分权限（仅可操作基础目录下的文件）。

## 5. 部署计划

### 5.1 直接部署

1. 确保 Linux 服务器已经安装 Python 3.12 和 `pip` 包管理工具，并具备访问 PyPI 或其镜像的网络连接条件。
2. 为系统部署创建新的 Python 虚拟环境，在源码目录下执行 `pip install -r requirements.txt`。
3. 在源码目录下执行 `fastapi run`，系统将监听 8000 端口，如需修改运行参数请参考 FastAPI 官方文档。
4. 在源码目录下执行 `python3 manage.py`，按提示创建第一个管理员用户。
5. （可选）配置 Supervisor 或 Systemd 以实现持久化运行和自动重启。

### 5.2 基于 Docker 部署

1. 确保 Linux 服务器已经安装 Docker 和 Docker Compose，并具备访问 DockerHub 或其镜像、PyPI 或其镜像的网络连接条件。
2. 按需修改源码目录下的 `docker-compose.yml`，配置挂载点及监听端口。
3. 在源码目录下执行 `docker-compose up -d` 或 `docker compose up -d`。
4. 在源码目录下执行 `docker-compose exec nfm python3 manage.py`，按提示创建第一个管理员用户。

## 6. 附录

### 6.1 参考文献

- [FastAPI 官方文档](https://fastapi.tiangolo.com/)
- [Vue 2 官方文档](https://v2.cn.vuejs.org/)
- [Ant Design Vue 官方文档](https://1x.antdv.com/docs/vue/introduce-cn/)

### 6.2 版本历史

- **版本 1.0**：2025 年 3 月 16 日，初次发布